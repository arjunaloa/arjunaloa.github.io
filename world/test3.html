<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pola Huruf</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: url('img/pemandangan.jpg') no-repeat center center fixed;
      touch-action: none;
    }

    .circle {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 300px;
      
      border: 2px solid white;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.7);
 
      /* Tidak ada z-index agar tetap di bawah canvas */
    }

    .letter {
      position: absolute;
      transform: translate(-50%, -50%);
      font-size: 30px;
      font-weight: 600;
      font-family: sans-serif;
      background: white;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000; /* Di atas canvas */
      pointer-events: none; /* Supaya tidak ganggu gesture */
      transition: all 0.5s ease;
    }

    .selected {
      background: blue;
      color: white;
    }
#shuffleBtn {
  position: absolute;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #fff;
  border: 2px solid #333;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  cursor: pointer;
  z-index: 1001; /* Harus lebih tinggi dari canvas */
  user-select: none;
}

#shuffleBtn:active {
  transform: translate(-50%, -50%) scale(0.9);
}

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 10;
      background: transparent;
    }
    
  html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: url('img/pemandangan.jpg') no-repeat center center fixed;
      background-size: cover;
      font-size: 1em;
      touch-action: none;
    }

    .circle {
      position: fixed;
      bottom: 10vh;
      left: 50%;
      transform: translateX(-50%);
      width: 60vw;
      height: 60vw;
      max-width: 300px;
      max-height: 300px;
      border: 0.3vh solid white;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.7);
    }

    .letter {
      position: absolute;
      transform: translate(-50%, -50%);
      font-size: 4.5vw;
      font-weight: 600;
      font-family: sans-serif;
      background: white;
      border-radius: 50%;
      width: 9vw;
      height: 9vw;
      max-width: 48px;
      max-height: 48px;
      min-width: 36px;
      min-height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      pointer-events: none;
      transition: all 0.5s ease;
    }

    .selected {
      background: blue;
      color: white;
    }

    #shuffleBtn {
      position: absolute;
      width: 10vw;
      height: 10vw;
      min-width: 44px;
      min-height: 44px;
      max-width: 60px;
      max-height: 60px;
      border-radius: 50%;
      background: #fff;
      border: 0.3vh solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 6vw;
      cursor: pointer;
      z-index: 1001;
      user-select: none;
      transform: translate(-50%, -50%);
    }

    #shuffleBtn:active {
      transform: translate(-50%, -50%) scale(0.9);
    }

    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 10;
      background: transparent;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div class="circle" id="circle"></div>
  <button id="shuffleBtn">
      <i class="bi bi-arrow-repeat"></i>
  </button>

  <script>
    let letters = 'ANJING'; // huruf di lingkaran
    const correctAnswer = 'ANJING'; // jawaban target
    const circle = document.getElementById('circle');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let points = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

function placeLetters(text) {
  const existingLetters = document.querySelectorAll('.letter');

  const circleRect = circle.getBoundingClientRect();
  const centerX = circleRect.left + circleRect.width / 2;
  const centerY = circleRect.top + circleRect.height / 2;
  const radius = circleRect.width / 2 - 40;
  const total = text.length;
  const angleStep = 360 / total;

  points = [];

  for (let i = 0; i < total; i++) {
    const angleDeg = i * angleStep - 90;
    const angleRad = angleDeg * Math.PI / 180;

    const x = centerX + radius * Math.cos(angleRad);
    const y = centerY + radius * Math.sin(angleRad);

    let span;
    if (existingLetters[i]) {
      span = existingLetters[i];
      span.textContent = text[i];
    } else {
      span = document.createElement('span');
      span.className = 'letter';
      span.textContent = text[i];
      document.body.appendChild(span);
    }

    span.style.left = `${x}px`;
    span.style.top = `${y}px`;
    span.style.transition = 'all 0.5s ease';

    points.push({
      x: x,
      y: y,
      id: i,
      used: false
    });
  }

  // Hapus huruf berlebih jika ada
  for (let i = text.length; i < existingLetters.length; i++) {
    existingLetters[i].remove();
  }

  // Posisikan ulang tombol acak
  const shuffleBtn = document.getElementById('shuffleBtn');
  shuffleBtn.style.left = `${centerX}px`;
  shuffleBtn.style.top = `${centerY}px`;
  shuffleBtn.style.transform = 'translate(-50%, -50%)';
}

    placeLetters(letters);

    let drawing = false;
    let path = [];

    function getTouchPos(e) {
      const t = e.touches ? e.touches[0] : e;
      return { x: t.clientX, y: t.clientY };
    }

    function getNearestPoint(pos) {
      const radius = 25;
      for (let p of points) {
        if (!p.used && Math.hypot(p.x - pos.x, p.y - pos.y) < radius) {
          p.used = true;
          document.querySelectorAll('.letter')[p.id].classList.add('selected');
          return p;
        }
      }
      return null;
    }

    function startDraw(e) {
      document.querySelectorAll('.letter').forEach(el => el.classList.remove('selected'));
      e.preventDefault();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let p of points) p.used = false;
      path = [];
      drawing = true;
      moveDraw(e);
    }

    function moveDraw(e) {
      if (!drawing) return;
      const pos = getTouchPos(e);
      const p = getNearestPoint(pos);
      if (p) path.push(p);

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.lineWidth = 10;
      ctx.strokeStyle = '#0077ff';
      ctx.beginPath();
      for (let i = 0; i < path.length; i++) {
        const pt = path[i];
        if (i === 0) ctx.moveTo(pt.x, pt.y);
        else ctx.lineTo(pt.x, pt.y);
      }
      if (drawing) ctx.lineTo(pos.x, pos.y); // follow finger
      ctx.stroke();
    }

    function endDraw(e) {
  document.querySelectorAll('.letter').forEach(el => el.classList.remove('selected'));
  if (!drawing) return;
  drawing = false;

  const result = path.map(p => letters[p.id]).join('');
  
  if (result===null || result===undefined || result===" ") {
      return
  }
  
  console.log('Polanya:', result);
  
  ctx.clearRect(0, 0, canvas.width, canvas.height);

const isCorrect = result === correctAnswer;
ctx.lineWidth = 10;
ctx.strokeStyle = isCorrect ? 'lime' : 'red'; // warna tergantung benar/salah
ctx.beginPath();
for (let i = 0; i < path.length; i++) {
  const pt = path[i];
  if (i === 0) ctx.moveTo(pt.x, pt.y);
  else ctx.lineTo(pt.x, pt.y);
}
ctx.stroke(); // gambar garis dengan warna yang sudah di-set

  

  setTimeout(() => ctx.clearRect(0, 0, canvas.width, canvas.height), 1000);
}
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', moveDraw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mouseleave', endDraw);

    canvas.addEventListener('touchstart', startDraw, { passive: false });
    canvas.addEventListener('touchmove', moveDraw, { passive: false });
    canvas.addEventListener('touchend', endDraw);
  
  function shuffleArray(arr) {
  // Durstenfeld shuffle
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}


function animateShuffle(newOrder) {
  const spans = document.querySelectorAll('.letter');
  const positions = [];
  points = [];

  // Ambil posisi setiap huruf
  spans.forEach((span, i) => {
    const rect = span.getBoundingClientRect();
    const x = rect.left + span.offsetWidth / 2;
    const y = rect.top + span.offsetHeight / 2;
    
    positions.push({ x: x, y: y, id: i, used: false });
    
  });

  // Buat mapping dari huruf -> indeks saat ini
  const currentText = Array.from(spans).map(span => span.textContent);
  const indexMap = {};
  currentText.forEach((char, index) => {
    if (!indexMap[char]) indexMap[char] = [];
    indexMap[char].push(index);
  });

  // Untuk setiap huruf dalam urutan baru
  newOrder.forEach((char, newIndex) => {
    const originalIndex = indexMap[char].shift(); // ambil indeks asli huruf ini
    const span = spans[originalIndex];
    
    const target = positions[newIndex];
    span.style.transition = 'all 0.3s ease';
    span.style.position = 'absolute';
    span.style.left = `${target.x}px`;
    span.style.top = `${target.y}px`;
    span.textContent = letters[originalIndex];
    
    
    points.push({
      x: target.x,
      y: target.y,
      id: originalIndex,
      used: false
    });
    
  });
  
  setTimeout(() => {
      shuffledAnimation = false;
      
  }, 600);
  

 
  
  
 
    
}

let shuffledAnimation = false

document.getElementById('shuffleBtn').addEventListener('click', () => {
  if (shuffledAnimation) {return;}
  shuffledAnimation = true
  let shuffled = letters.split('');
  do {
    shuffled = shuffled.sort(() => Math.random() - 0.5);
  } while (shuffled.join('') === letters); // hindari hasil sama
  letters = shuffled.join(''); // perbarui urutan
  animateShuffle(shuffled);
});
  
  </script>
</body>
</html>